<!DOCTYPE HTML>
<html>
<head>
    <!-- Load jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    
    <!-- Load Highcharts -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/boxplot.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    
    <!-- Include PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div id="container" style="width:100%; height:400px;"></div>

    <script>
    // Use the raw GitHub URL for the CSV file
    var url = 'https://raw.githubusercontent.com/Drit92/Higcharts_interactive_chart/main/auto-mpg.csv';
    
    console.log("Loading CSV from URL:", url); // Debugging line to check if the URL is correct

    $.get(url, function(csv) {
        
        console.log("CSV Data Loaded:", csv); // Debugging line to check if CSV is loaded

        // Parse the CSV data using PapaParse
        Papa.parse(csv, {
            header: true,  // Treat the first row as headers
            dynamicTyping: true,  // Automatically convert data types
            complete: function(results) {
                
                console.log("Parsed CSV Data:", results.data); // Log the parsed CSV data
                
                // Extract the model year and weight columns
                var dataPoints = results.data
                    .filter(function(row) {
                        // Filter out rows where 'model year' or 'weight' are invalid or missing
                        return row['model year'] && !isNaN(row['weight']); // Ensure non-null and numeric
                    })
                    .map(function(row) {
                        return {
                            x: row['model year'],  // Assuming 'model year' is the column name
                            y: row['weight']       // 'weight' is the column name for car weights
                        };
                    });

                console.log("Processed Data Points:", dataPoints); // Log the processed data points

                if (dataPoints.length > 0) {
                    // Create the Highcharts scatter plot if data exists
                    $('#container').highcharts({
                        chart: {
                            type: 'scatter'
                        },

                        title: {
                            text: 'Scatter Plot of Car Weights by Model Year'
                        },

                        xAxis: {
                            title: {
                                text: 'Model Year'
                            },
                            min: Math.min(...dataPoints.map(p => p.x)), // Set x-axis min and max for better visualization
                            max: Math.max(...dataPoints.map(p => p.x))
                        },

                        yAxis: {
                            title: {
                                text: 'Weight'
                            },
                            min: Math.min(...dataPoints.map(p => p.y)),  // Set y-axis min and max
                            max: Math.max(...dataPoints.map(p => p.y))
                        },

                        series: [{
                            name: 'Car Weights',
                            data: dataPoints,
                            tooltip: {
                                pointFormat: '<b>Weight:</b> {point.y}<br>' +
                                             '<b>Model Year:</b> {point.x}'
                            }
                        }]
                    });
                } else {
                    console.error('No valid data points found!');
                }
            },
            error: function(error) {
                console.error('Error parsing CSV:', error);
            }
        });
    }).fail(function(err) {
        console.error('Error loading CSV file:', err); // Log if the CSV file fails to load
    });
    </script>
</body>
</html>
